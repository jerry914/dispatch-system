(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4cd9a090"],{"0195":function(e,t,n){"use strict";n("8ba4"),n("a9e3");var i=n("7a23"),r=function(e){return Object(i["N"])("data-v-7d703a32"),e=e(),Object(i["L"])(),e},o={class:"assignTimePicker"},c=r((function(){return Object(i["n"])("option",{value:""},"請選擇或輸入學期標籤",-1)})),l=["value"],a={class:"radius-box"};function s(e,t,n,r,s,u){var b=Object(i["T"])("el-col"),d=Object(i["T"])("el-row");return Object(i["K"])(),Object(i["m"])("div",o,[Object(i["n"])("div",null,[Object(i["kb"])(Object(i["n"])("select",{class:"labelSelector","onUpdate:modelValue":t[0]||(t[0]=function(e){return s.semesterLabel=e}),onChange:t[1]||(t[1]=function(){return u.changeLabel&&u.changeLabel.apply(u,arguments)})},[c,(Object(i["K"])(!0),Object(i["m"])(i["b"],null,Object(i["R"])(s.labelOption,(function(e){return Object(i["K"])(),Object(i["m"])("option",{key:e.label,value:e.label},Object(i["X"])(e.label),9,l)})),128))],544),[[i["eb"],s.semesterLabel]])]),Object(i["n"])("div",a,[Object(i["r"])(d,null,{default:Object(i["jb"])((function(){return[Object(i["r"])(b,{class:"picker-col-lable row-border",span:4}),(Object(i["K"])(!0),Object(i["m"])(i["b"],null,Object(i["R"])(e.days,(function(e){return Object(i["K"])(),Object(i["k"])(b,{class:"picker-col row-border",span:4},{default:Object(i["jb"])((function(){return[Object(i["q"])(Object(i["X"])(e.label),1)]})),_:2},1024)})),256))]})),_:1}),(Object(i["K"])(!0),Object(i["m"])(i["b"],null,Object(i["R"])(e.times,(function(t,n){return Object(i["K"])(),Object(i["k"])(d,{class:"picker-row",justify:"space-around",style:Object(i["B"])(Number.isInteger(t.value)?"":"border-top: 2px solid #F2A54B")},{default:Object(i["jb"])((function(){return[Object(i["r"])(b,{class:"picker-col-lable",span:4},{default:Object(i["jb"])((function(){return[Object(i["q"])(Object(i["X"])(t.label),1)]})),_:2},1024),(Object(i["K"])(!0),Object(i["m"])(i["b"],null,Object(i["R"])(e.days,(function(e,n){return Object(i["K"])(),Object(i["k"])(b,{class:"picker-col pickable",span:4,onMouseenter:u.mouseEnter,onMouseleave:u.mouseLeave,onMousedown:function(n){return u.mouseDown(n,e.value+t.value)},onMouseup:u.mouseUp,onMousemove:function(n){return u.mouseMove(n,e.value+t.value)}},null,8,["onMouseenter","onMouseleave","onMousedown","onMouseup","onMousemove"])})),256))]})),_:2},1032,["style"])})),256))])])}var u=n("c7eb"),b=n("1da1"),d=(n("ac1f"),n("1276"),n("a434"),n("4e82"),n("a15b"),n("b3e6")),m={mixins:[d["a"]],props:{modelValue:Object,default:function(){return{available_time:"",semester_label:""}}},setup:function(e,t){var n=t.emit,r=Object(i["i"])({get:function(){return e.modelValue},set:function(e){return n("update:modelValue",e)}});return{theModel:r}},data:function(){return{mousepressed:!1,mousepop:!1,selectedTime:[],semesterLabel:"",labelOption:""}},watch:{modelValue:function(){this.createBlock()}},created:function(){var e=this;return Object(b["a"])(Object(u["a"])().mark((function t(){return Object(u["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$store.state.cases.length<=0&&e.$store.dispatch("fetchCases"),t.next=3,e.$store.dispatch("fetchSemesterLabel");case 3:e.labelOption=e.$store.state.semester_label.data;case 4:case"end":return t.stop()}}),t)})))()},mounted:function(){this.createBlock()},methods:{createBlock:function(){if(this.modelValue){var e=[],t=this.modelValue.available_time;this.semesterLabel=this.modelValue.semester_label;try{e=t.split(",")}catch(o){console.error("Error occurred while parsing modelValue:",o)}if(e.length>1){this.clearBlock(),this.selectedTime=[];for(var n=0;n<e.length;n++){this.selectedTime.push(e[n]);var i=e[n].split("");i[0]=parseInt(this.dayRule[i[0]])-1,i[1]=parseInt(this.timeRule[i[1]])-1;var r=document.getElementsByClassName("pickable");r[i[0]+5*i[1]].classList.add("picked")}}}},clearBlock:function(){for(var e=document.getElementsByClassName("pickable"),t=0;t<e.length;t++)e[t].classList.remove("picked");this.selectedTime=[]},mouseEnter:function(){},mouseLeave:function(){this.mousepop=!1},mouseDown:function(e,t){this.mousepressed=!0,this.handleTime(e,t)},mouseUp:function(){this.mousepressed=!1},mouseMove:function(e,t){this.mousepressed&&!this.mousepop&&this.handleTime(e,t)},handleTime:function(e,t){var n=this;if(e.target.classList.toggle("picked"),e.target.classList.contains("picked"))this.selectedTime.push(t);else{var i=this.selectedTime.indexOf(t);i>-1&&this.selectedTime.splice(i,1)}this.selectedTime.sort((function(e,t){var i=e.split(""),r=t.split("");return i[0]=n.dayRule[i[0]],r[0]=n.dayRule[r[0]],i[0]==r[0]?n.timeRule[i[1]]-n.timeRule[r[1]]:i[0]-r[0]})),this.mousepop=!0;var r=this.selectedTime.join(",");this.$emit("update:modelValue",{available_time:r,semester_label:this.semesterLabel})},changeLabel:function(){var e=this.selectedTime.join(",");this.$emit("update:modelValue",{available_time:e,semester_label:this.semesterLabel})}}},f=(n("6e03"),n("d959")),p=n.n(f);const j=p()(m,[["render",s],["__scopeId","data-v-7d703a32"]]);t["a"]=j},"4de4":function(e,t,n){"use strict";var i=n("23e7"),r=n("b727").filter,o=n("1dde"),c=o("filter");i({target:"Array",proto:!0,forced:!c},{filter:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},"5e72":function(e,t,n){},"6e03":function(e,t,n){"use strict";n("721e")},"721e":function(e,t,n){},"72b1":function(e,t,n){"use strict";n.r(t);n("b0c0");var i=n("7a23"),r=function(e){return Object(i["N"])("data-v-3da90fe8"),e=e(),Object(i["L"])(),e},o={class:"page-container"},c=r((function(){return Object(i["n"])("div",{class:"page-title"},"值日端-修改個案",-1)})),l=Object(i["q"])("取消"),a=Object(i["q"])("儲存"),s={class:"dialog-footer",slot:"footer",style:{"text-align":"center"}},u=Object(i["q"])("確定");function b(e,t,n,r,b,d){var m=Object(i["T"])("el-input"),f=Object(i["T"])("el-form-item"),p=Object(i["T"])("assignTimePicker"),j=Object(i["T"])("el-col"),O=Object(i["T"])("el-option"),h=Object(i["T"])("el-select"),_=Object(i["T"])("el-autocomplete"),v=Object(i["T"])("el-date-picker"),g=Object(i["T"])("el-button"),k=Object(i["T"])("el-row"),T=Object(i["T"])("el-form"),V=Object(i["T"])("el-result"),y=Object(i["T"])("el-dialog");return Object(i["K"])(),Object(i["m"])("div",o,[c,Object(i["r"])(T,{model:b.form,rules:b.rules,ref:"form","label-width":"100px"},{default:Object(i["jb"])((function(){return[Object(i["r"])(k,null,{default:Object(i["jb"])((function(){return[Object(i["r"])(j,{sm:24,md:12},{default:Object(i["jb"])((function(){return[Object(i["r"])(f,{label:"姓名",prop:"name"},{default:Object(i["jb"])((function(){return[Object(i["r"])(m,{class:"input-container",placeholder:"請輸入姓名",modelValue:b.form.name,"onUpdate:modelValue":t[0]||(t[0]=function(e){return b.form.name=e})},null,8,["modelValue"])]})),_:1}),Object(i["r"])(f,{label:"學號",prop:"caseId"},{default:Object(i["jb"])((function(){return[Object(i["r"])(m,{class:"input-container",placeholder:"請輸入學號",modelValue:b.form.caseId,"onUpdate:modelValue":t[1]||(t[1]=function(e){return b.form.caseId=e})},null,8,["modelValue"])]})),_:1}),Object(i["r"])(f,{label:"可諮商時段",prop:"time_picker"},{default:Object(i["jb"])((function(){return[Object(i["r"])(p,{modelValue:b.form.time_picker,"onUpdate:modelValue":t[2]||(t[2]=function(e){return b.form.time_picker=e}),ref:"timePicker"},null,8,["modelValue"])]})),_:1})]})),_:1}),Object(i["r"])(j,{sm:24,md:12},{default:Object(i["jb"])((function(){return[Object(i["r"])(f,{label:"危機程度",prop:"crisis_level"},{default:Object(i["jb"])((function(){return[Object(i["r"])(h,{class:"input-container",placeholder:"請輸入危機程度",modelValue:b.form.crisis_level,"onUpdate:modelValue":t[3]||(t[3]=function(e){return b.form.crisis_level=e})},{default:Object(i["jb"])((function(){return[(Object(i["K"])(!0),Object(i["m"])(i["b"],null,Object(i["R"])(b.crisis_options,(function(e){return Object(i["K"])(),Object(i["k"])(O,{key:e,label:e,value:e},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(i["r"])(f,{label:"初談老師",prop:"init_counselor_name"},{default:Object(i["jb"])((function(){return[Object(i["r"])(_,{class:"input-container",modelValue:b.form.init_counselor_name,"onUpdate:modelValue":t[4]||(t[4]=function(e){return b.form.init_counselor_name=e}),"fetch-suggestions":e.querySearch,placeholder:"請輸入初談老師"},null,8,["modelValue","fetch-suggestions"])]})),_:1}),Object(i["r"])(f,{label:"狀況說明",prop:"discription"},{default:Object(i["jb"])((function(){return[Object(i["r"])(m,{class:"input-container",type:"textarea",placeholder:"請輸入狀況說明",autosize:{minRows:3,maxRows:6},modelValue:b.form.discription,"onUpdate:modelValue":t[5]||(t[5]=function(e){return b.form.discription=e})},null,8,["modelValue"])]})),_:1}),Object(i["r"])(f,{label:"初談時間",prop:"init_consultation_date"},{default:Object(i["jb"])((function(){return[Object(i["r"])(v,{modelValue:b.form.init_consultation_date,"onUpdate:modelValue":t[6]||(t[6]=function(e){return b.form.init_consultation_date=e}),type:"date"},null,8,["modelValue"])]})),_:1}),Object(i["r"])(k,null,{default:Object(i["jb"])((function(){return[Object(i["r"])(j,{span:4,offset:12},{default:Object(i["jb"])((function(){return[Object(i["r"])(g,{type:"danger",onClick:d.cancelForm},{default:Object(i["jb"])((function(){return[l]})),_:1},8,["onClick"])]})),_:1}),Object(i["r"])(j,{span:4},{default:Object(i["jb"])((function(){return[Object(i["r"])(g,{type:"primary",onClick:t[7]||(t[7]=function(e){return d.submitForm("form")})},{default:Object(i["jb"])((function(){return[a]})),_:1})]})),_:1})]})),_:1})]})),_:1})]})),_:1})]})),_:1},8,["model","rules"]),Object(i["r"])(y,{title:"狀態",modelValue:b.dialogVisible,"onUpdate:modelValue":t[9]||(t[9]=function(e){return b.dialogVisible=e}),width:"30%",onClose:d.handleClose,center:""},{default:Object(i["jb"])((function(){return[Object(i["r"])(V,{icon:"success",title:"儲存成功",subTitle:"點擊確定關閉提示"}),Object(i["n"])("div",s,[Object(i["r"])(g,{type:"primary",onClick:t[8]||(t[8]=function(e){return b.dialogVisible=!1})},{default:Object(i["jb"])((function(){return[u]})),_:1})])]})),_:1},8,["modelValue","onClose"])])}var d=n("0195"),m=n("c343"),f=n("b3e6"),p={mixins:[m["a"],f["a"]],name:"modifyCase",components:{assignTimePicker:d["a"]},data:function(){return{form:{caseId:"",name:"",time_picker:{available_time:"",semester_label:""},crisis_level:"",init_counselor_name:"",discription:"",init_consultation_date:""},crisis_options:["A+","A","A-","B+","B","B-","C"],rules:{name:[{required:!0,message:"請輸入姓名",trigger:"blur"}],id:[{required:!0,message:"請輸入學號",trigger:"blur"}],crisis_level:[{required:!0,message:"請選擇危機程度",trigger:"blur"}],init_consultation_date:[{required:!0,message:"請選擇日期",trigger:"blur"}],init_counselor_name:[{required:!0,message:"請輸入初談老師",trigger:"change"}]},dialogVisible:!1}},created:function(){this.getCase()},methods:{getCase:function(){var e=this;this.$http.get("/api/cases/"+this.$route.params.id).then((function(t){e.form=t.data.data[0],e.form.init_consultation_date=e.convertUTCtoStr(e.form.init_consultation_date),e.form.time_picker={available_time:e.form.available_time,semester_label:e.form.semester_label}})).catch((function(e){console.log(e)}))},putCase:function(e){var t=this;console.log(this.form.init_consultation_date);try{this.form.init_consultation_date=this.convertUTCtoStr(this.form.init_consultation_date)}catch(n){console.log(n)}this.$http.put("/api/cases/"+e,{caseId:this.form.caseId,name:this.form.name,semester_label:this.form.time_picker.semester_label,available_time:this.form.time_picker.available_time,crisis_level:this.form.crisis_level,init_counselor_name:this.form.init_counselor_name,discription:""==this.form.discription?"無":this.form.discription,init_consultation_date:this.form.init_consultation_date}).then((function(e){console.log(e.data.message),t.dialogVisible=!0,t.$store.dispatch("fetchUnassignCases"),t.$store.commit("SET_STATUS","end")})).catch((function(e){console.log(e)}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;t.$store.commit("SET_STATUS","pending"),t.putCase(t.$route.params.id)}))},resetForm:function(e){this.$refs[e].resetFields(),this.$refs.timePicker.clearBlock()},handleClose:function(){console.log("finish modify")},cancelForm:function(){this.$router.push("/listCases")}}},j=(n("88e6"),n("d959")),O=n.n(j);const h=O()(p,[["render",b],["__scopeId","data-v-3da90fe8"]]);t["default"]=h},"88e6":function(e,t,n){"use strict";n("5e72")},a15b:function(e,t,n){"use strict";var i=n("23e7"),r=n("e330"),o=n("44ad"),c=n("fc6a"),l=n("a640"),a=r([].join),s=o!=Object,u=l("join",",");i({target:"Array",proto:!0,forced:s||!u},{join:function(e){return a(c(this),void 0===e?",":e)}})},a434:function(e,t,n){"use strict";var i=n("23e7"),r=n("7b0b"),o=n("23cb"),c=n("5926"),l=n("07fa"),a=n("3511"),s=n("65f0"),u=n("8418"),b=n("083a"),d=n("1dde"),m=d("splice"),f=Math.max,p=Math.min;i({target:"Array",proto:!0,forced:!m},{splice:function(e,t){var n,i,d,m,j,O,h=r(this),_=l(h),v=o(e,_),g=arguments.length;for(0===g?n=i=0:1===g?(n=0,i=_-v):(n=g-2,i=p(f(c(t),0),_-v)),a(_+n-i),d=s(h,i),m=0;m<i;m++)j=v+m,j in h&&u(d,m,h[j]);if(d.length=i,n<i){for(m=v;m<_-i;m++)j=m+i,O=m+n,j in h?h[O]=h[j]:b(h,O);for(m=_;m>_-i+n;m--)b(h,m-1)}else if(n>i)for(m=_-i;m>v;m--)j=m+i-1,O=m+n-1,j in h?h[O]=h[j]:b(h,O);for(m=0;m<n;m++)h[m+v]=arguments[m+2];return h.length=_-i+n,d}})},c343:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n("d3b7"),n("159b"),n("b0c0"),n("4de4");var i={data:function(){return{}},created:function(){this.$store.state.counselors.length<=0&&this.$store.dispatch("fetchCounselors")},methods:{querySearch:function(e,t){var n=this.$store.state.counselors;n.forEach((function(e){e.value=e.name}));var i=e?n.filter(this.createFilter(e)):n;t(i)},createFilter:function(e){return function(t){return t.value.toLowerCase().indexOf(e.toLowerCase())>=0}}}}}}]);
//# sourceMappingURL=chunk-4cd9a090.58c46297.js.map