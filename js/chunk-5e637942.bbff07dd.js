(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e637942"],{"129f":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},2532:function(t,e,n){"use strict";var a=n("23e7"),c=n("e330"),i=n("5a34"),o=n("1d80"),r=n("577e"),s=n("ab13"),l=c("".indexOf);a({target:"String",proto:!0,forced:!s("includes")},{includes:function(t){return!!~l(r(o(this)),r(i(t)),arguments.length>1?arguments[1]:void 0)}})},"561c":function(t,e,n){},"5a34":function(t,e,n){var a=n("44e7"),c=TypeError;t.exports=function(t){if(a(t))throw c("The method doesn't accept regular expressions");return t}},7024:function(t,e,n){},"80a8":function(t,e,n){},8111:function(t,e,n){"use strict";var a=n("7a23");function c(t,e,n,c,i,o){return Object(a["K"])(),Object(a["m"])("div",{class:"semester_label_tag",style:Object(a["B"])(o.getStyleForLabel(n.label))},Object(a["X"])(n.label),5)}var i=n("c7eb"),o=n("1da1"),r=(n("7db0"),n("d3b7"),n("99af"),{props:{label:{type:String,required:!0}},data:function(){return{labelOptions:[]}},created:function(){var t=this;return Object(o["a"])(Object(i["a"])().mark((function e(){return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(t.$store.state.semester_label.length<=0)){e.next=3;break}return e.next=3,t.$store.dispatch("fetchSemesterLabel");case 3:t.labelOptions=t.$store.state.semester_label.data;case 4:case"end":return e.stop()}}),e)})))()},methods:{getLabelColor:function(t){var e=this.labelOptions.find((function(e){return e.label===t}));return e?e.color:"defaultColor"},getStyleForLabel:function(t){var e=this.getLabelColor(t);return"background-color: ".concat(e,"44; color: ").concat(e,"; border: 1px solid ").concat(e)}}}),s=(n("cfff"),n("d959")),l=n.n(s);const u=l()(r,[["render",c]]);e["a"]=u},"841c":function(t,e,n){"use strict";var a=n("c65b"),c=n("d784"),i=n("825a"),o=n("1d80"),r=n("129f"),s=n("577e"),l=n("dc4a"),u=n("14c3");c("search",(function(t,e,n){return[function(e){var n=o(this),c=void 0==e?void 0:l(e,t);return c?a(c,e,n):new RegExp(e)[t](s(n))},function(t){var a=i(this),c=s(t),o=n(e,a,c);if(o.done)return o.value;var l=a.lastIndex;r(l,0)||(a.lastIndex=0);var d=u(a,c);return r(a.lastIndex,l)||(a.lastIndex=l),null===d?-1:d.index}]}))},a5ff:function(t,e,n){"use strict";n("80a8")},ab13:function(t,e,n){var a=n("b622"),c=a("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[c]=!1,"/./"[t](e)}catch(a){}}return!1}},caad:function(t,e,n){"use strict";var a=n("23e7"),c=n("4d64").includes,i=n("d039"),o=n("44d2"),r=i((function(){return!Array(1).includes()}));a({target:"Array",proto:!0,forced:r},{includes:function(t){return c(this,t,arguments.length>1?arguments[1]:void 0)}}),o("includes")},cfff:function(t,e,n){"use strict";n("561c")},df53:function(t,e,n){"use strict";n("7024")},f20e:function(t,e,n){"use strict";n.r(e);n("ac1f"),n("841c");var a=n("7a23"),c=function(t){return Object(a["N"])("data-v-46024200"),t=t(),Object(a["L"])(),t},i={class:"page-container"},o=c((function(){return Object(a["n"])("div",{class:"page-title"},"個案列表",-1)})),r=Object(a["q"])("下載Excel"),s=Object(a["q"])("下載CSV"),l={key:0},u={key:1,class:"empty-cell"},d=Object(a["q"])("已結案"),b=Object(a["q"])("諮商中"),f=Object(a["q"])("未派案"),j={key:0},_={key:1,class:"empty-cell"},O={key:0},m={key:1,class:"empty-cell"},p={key:0},h={key:1,class:"empty-cell"},v={key:0},g={key:1,class:"empty-cell"},w={key:0},y={key:1,class:"empty-cell"},x={key:0},k={key:1,class:"empty-cell"},S=Object(a["q"])("修改"),T=Object(a["q"])("刪除");function C(t,e,n,c,C,K){var D=Object(a["T"])("el-col"),V=Object(a["T"])("el-button"),$=Object(a["T"])("download-excel"),A=Object(a["T"])("el-row"),U=Object(a["T"])("el-input"),L=Object(a["T"])("el-table-column"),z=Object(a["T"])("SemesterLabelTag"),E=Object(a["T"])("el-date-picker"),I=Object(a["T"])("el-tag"),q=Object(a["T"])("el-table");return Object(a["K"])(),Object(a["m"])("div",i,[Object(a["r"])(A,null,{default:Object(a["jb"])((function(){return[Object(a["r"])(D,{span:12},{default:Object(a["jb"])((function(){return[o]})),_:1}),Object(a["r"])(D,{span:12},{default:Object(a["jb"])((function(){return[Object(a["r"])($,{data:K.downloadXLS(),fields:C.json_fields,name:"個案列表"+K.getDateStr(0)+".xls"},{default:Object(a["jb"])((function(){return[Object(a["r"])(V,{type:"success",size:"medium",style:{float:"right","margin-top":"30px"}},{default:Object(a["jb"])((function(){return[r]})),_:1})]})),_:1},8,["data","fields","name"]),Object(a["r"])(V,{type:"success",size:"medium",style:{float:"right","margin-top":"30px","margin-right":"10px"},onClick:e[0]||(e[0]=function(t){return K.downloadCSV()})},{default:Object(a["jb"])((function(){return[s]})),_:1})]})),_:1})]})),_:1}),Object(a["r"])(q,{class:"list-container",data:K.cases,style:{width:"100%"},height:K.tableHeight},{default:Object(a["jb"])((function(){return[Object(a["r"])(L,{prop:"name",label:"姓名"},{header:Object(a["jb"])((function(){return[Object(a["r"])(U,{modelValue:C.search,"onUpdate:modelValue":e[1]||(e[1]=function(t){return C.search=t}),size:"small","prefix-icon":"el-icon-search",placeholder:"輸入姓名搜尋"},null,8,["modelValue"])]})),_:1}),Object(a["r"])(L,{prop:"caseId",label:"學號"}),Object(a["r"])(L,{prop:"init_counselor_name",label:"初談心理師"}),Object(a["r"])(L,{prop:"available_time_num",label:"初談後所提供可選擇的時段數目"}),Object(a["r"])(L,{prop:"crisis_level",label:"危機程度",sortable:"","sort-method":K.levelRule},null,8,["sort-method"]),Object(a["r"])(L,{prop:"discription",label:"狀態說明"}),Object(a["r"])(L,{prop:"semester_label",label:"學期標籤"},{default:Object(a["jb"])((function(t){return[Object(a["r"])(z,{label:t.row.semester_label},null,8,["label"])]})),_:1}),Object(a["r"])(L,{prop:"init_consultation_date",label:"初談入案時間",width:"180px"},{default:Object(a["jb"])((function(t){return[C.form[t.row.id]?(Object(a["K"])(),Object(a["m"])("div",l,[Object(a["r"])(E,{modelValue:C.form[t.row.id].init_consultation_date,"onUpdate:modelValue":function(e){return C.form[t.row.id].init_consultation_date=e},type:"date",size:"mini",style:{width:"80%"}},null,8,["modelValue","onUpdate:modelValue"])])):(Object(a["K"])(),Object(a["m"])("div",u,"無資料"))]})),_:1}),Object(a["r"])(L,{label:"是否派案"},{default:Object(a["jb"])((function(t){return["closed"==t.row.status?(Object(a["K"])(),Object(a["k"])(I,{key:0,type:"info",size:"small"},{default:Object(a["jb"])((function(){return[d]})),_:1})):"assign"==t.row.status?(Object(a["K"])(),Object(a["k"])(I,{key:1,size:"small"},{default:Object(a["jb"])((function(){return[b]})),_:1})):(Object(a["K"])(),Object(a["k"])(I,{key:2,type:"danger",size:"small"},{default:Object(a["jb"])((function(){return[f]})),_:1}))]})),_:1}),Object(a["r"])(L,{prop:"counselor_name",label:"派案心理師"},{default:Object(a["jb"])((function(t){return["unassign"!=t.row.status?(Object(a["K"])(),Object(a["m"])("div",j,Object(a["X"])(t.row.counselor_name),1)):(Object(a["K"])(),Object(a["m"])("div",_,"無資料"))]})),_:1}),Object(a["r"])(L,{label:"諮商時段"},{default:Object(a["jb"])((function(t){return["unassign"!=t.row.status?(Object(a["K"])(),Object(a["m"])("div",O,Object(a["X"])(t.row.consultation_datetime),1)):(Object(a["K"])(),Object(a["m"])("div",m,"無資料"))]})),_:1}),Object(a["r"])(L,{prop:"first_consultation_date",label:"第一次諮商日期",width:"180px"},{default:Object(a["jb"])((function(t){return["unassign"!=t.row.status&&C.form[t.row.id]?(Object(a["K"])(),Object(a["m"])("div",p,[Object(a["r"])(E,{modelValue:C.form[t.row.id].first_consultation_date,"onUpdate:modelValue":function(e){return C.form[t.row.id].first_consultation_date=e},type:"date",size:"mini",style:{width:"80%"}},null,8,["modelValue","onUpdate:modelValue"])])):(Object(a["K"])(),Object(a["m"])("div",h,"無資料"))]})),_:1}),Object(a["r"])(L,{prop:"end_consultation_date",label:"結案日期",width:"90px"},{default:Object(a["jb"])((function(t){return["closed"==t.row.status?(Object(a["K"])(),Object(a["m"])("div",v,Object(a["X"])(t.row.end_consultation_date_text),1)):(Object(a["K"])(),Object(a["m"])("div",g,"無資料"))]})),_:1}),Object(a["r"])(L,{label:"諮商次數",width:"60px"},{default:Object(a["jb"])((function(t){return["unassign"!=t.row.status?(Object(a["K"])(),Object(a["m"])("div",w,Object(a["X"])(t.row.consultation_number),1)):(Object(a["K"])(),Object(a["m"])("div",y,"無資料"))]})),_:1}),Object(a["r"])(L,{label:"派案間隔時長(天)",width:"80px"},{default:Object(a["jb"])((function(t){return["unassign"!=t.row.status?(Object(a["K"])(),Object(a["m"])("div",x,Object(a["X"])(t.row.dispatch_interval_duration),1)):(Object(a["K"])(),Object(a["m"])("div",k,"無資料"))]})),_:1}),Object(a["r"])(L,{label:"功能按鈕",align:"center",width:"150px"},{default:Object(a["jb"])((function(t){return[Object(a["r"])(V,{type:"success",size:"mini",onClick:function(e){return K.modifyCase(t.row.id)}},{default:Object(a["jb"])((function(){return[S]})),_:2},1032,["onClick"]),Object(a["r"])(V,{type:"danger",size:"mini",onClick:function(e){return K.clickDelete(t.row)}},{default:Object(a["jb"])((function(){return[T]})),_:2},1032,["onClick"])]})),_:1})]})),_:1},8,["data","height"])])}var K=n("c7eb"),D=n("1da1"),V=(n("d3b7"),n("159b"),n("1276"),n("4de4"),n("caad"),n("2532"),n("b0c0"),n("d81d"),n("b64b"),n("a15b"),n("b3e6")),$=n("8111"),A=n("2ef0"),U=n.n(A),L={components:{SemesterLabelTag:$["a"]},mixins:[V["a"]],data:function(){return{form:[],json_fields:{"姓名":"name","學號":"caseId","初談心理師":"init_counselor_name","學期標籤":"semester_label","初談後所提供可選擇的時段數目":"available_time_num","危機程度":"crisis_level","狀態說明":"discription","初談入案時間":"init_consultation_date_text","派案狀態":"status_text","派案心理師":"counselor_name","諮商時段":"consultation_datetime","第一次諮商日期":"first_consultation_date_text","結案諮商日期":"end_consultation_date_text","諮商次數":"consultation_number","派案間隔時長(天)":"dispatch_interval_duration"},search:""}},created:function(){var t=this;return Object(D["a"])(Object(K["a"])().mark((function e(){return Object(K["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("fetchCases");case 2:t.cases.forEach((function(e){var n=new Date(e.first_consultation_date),a=new Date(e.init_consultation_date);t.form[e.id]={first_consultation_date:n,init_consultation_date:a}}));case 3:case"end":return e.stop()}}),e)})))()},computed:{cases:function(){var t=this,e=U.a.cloneDeep(this.$store.state.cases);return e.forEach((function(n,a){n.init_consultation_date?e[a].init_consultation_date_text=t.convertUTCtoStr(n.init_consultation_date):(e[a].init_consultation_date="1970-1-1",e[a].init_consultation_date_text="N/A"),e[a].status_text="closed"==n.status?"已結案":"assign"==n.status?"諮商中":"未派案",e[a].first_consultation_date_text="N/A",e[a].consultation_datetime="N/A",e[a].consultation_number="N/A",e[a].dispatch_interval_duration="N/A",e[a].end_consultation_date_text="N/A",e[a].available_time_num=n.available_time.split(",").length,"unassign"!=n.status&&(e[a].first_consultation_date_text=t.convertUTCtoStr(n.first_consultation_date),e[a].consultation_datetime=n.consultation_day+n.consultation_time,e[a].consultation_number=t.countConsultationNumber(t.getDateStr(0),n.first_consultation_date),e[a].dispatch_interval_duration=t.countRangeDay(n.first_consultation_date,n.init_consultation_date),"assign"!=n.status&&(e[a].end_consultation_date_text=t.convertUTCtoStr(n.end_consultation_date)))})),e.filter((function(e){return!t.search||e.name.toLowerCase().includes(t.search.toLowerCase())}))},tableHeight:function(){return window.innerHeight-150}},methods:{downloadXLS:function(){var t=U.a.cloneDeep(this.cases);return t},downloadCSV:function(){var t=U.a.cloneDeep(this.cases),e=this.buildCSVContent(t),n=encodeURI(e);window.open(n)},buildRow:function(t){var e=this;return Object.keys(this.json_fields).map((function(n){return t[e.json_fields[n]]}))},buildCSVContent:function(t){var e=this,n=[Object.keys(this.json_fields)];return t.forEach((function(t){n.push(e.buildRow(t))})),"data:text/csv;charset=utf-8,"+n.map((function(t){return t.join(",")})).join("\r\n")},getDateStr:function(t){var e;return e=0!=t?new Date(t):new Date,e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},deleteCase:function(t){var e=this;this.$store.commit("SET_STATUS","pending"),this.$http.delete("/api/cases/"+t).then((function(t){console.log(t.data.message),e.$message({type:"success",message:"刪除成功!"}),e.$store.dispatch("fetchCases"),e.$store.commit("SET_STATUS","end")})).catch((function(t){console.log(t)}))},clickDelete:function(t){var e=this;this.$confirm("將永久刪除學號為 "+t.caseId+" 的資料, 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){e.deleteCase(t.id)})).catch((function(){e.$message({type:"info",message:"已取消刪除"})}))},modifyCase:function(t){var e=this;this.$store.commit("SET_STATUS","pending"),this.$http.put("/api/cases/"+t,{init_consultation_date:this.getDateStr(this.form[t].init_consultation_date),first_consultation_date:this.getDateStr(this.form[t].first_consultation_date)}).then((function(t){console.log(t.data.message),e.$store.dispatch("fetchCases"),e.$store.commit("SET_STATUS","end")})).catch((function(t){console.log(t)}))},levelRule:function(t,e){var n=t.crisis_level,a=e.crisis_level,c=0,i=0,o={A:50,B:30,C:10},r={"+":5,"-":-5};for(var s in o)n.indexOf(s)>=0&&(c+=o[s]),a.indexOf(s)>=0&&(i+=o[s]);for(var l in r)n.indexOf(l)>=0&&(c+=r[l]),a.indexOf(l)>=0&&(i+=r[l]);return c-i}}},z=(n("df53"),n("a5ff"),n("d959")),E=n.n(z);const I=E()(L,[["render",C],["__scopeId","data-v-46024200"]]);e["default"]=I}}]);
//# sourceMappingURL=chunk-5e637942.bbff07dd.js.map