(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-76ec1784"],{"367f":function(t,e,n){},"494e":function(t,e,n){},"4d36":function(t,e,n){"use strict";n.r(e);var s=n("7a23"),c=function(t){return Object(s["N"])("data-v-75fe07af"),t=t(),Object(s["L"])(),t},r={class:"page-container"},a=c((function(){return Object(s["n"])("div",{class:"page-title"},"派案列表",-1)})),i=c((function(){return Object(s["n"])("option",{value:""},"請選擇或輸入學期標籤",-1)})),o=["value"],l=Object(s["q"])("下載Excel"),u=Object(s["q"])("下載CSV"),b=c((function(){return Object(s["n"])("strong",null,"操作方式",-1)})),j=c((function(){return Object(s["n"])("div",null,"點擊時段可以查看更詳細排班情況",-1)})),f=c((function(){return Object(s["n"])("br",null,null,-1)})),O=c((function(){return Object(s["n"])("strong",null,"方塊顏色意義",-1)})),d=c((function(){return Object(s["n"])("div",null,"灰色空格：心理師此時段為有空",-1)})),m=c((function(){return Object(s["n"])("div",null,"藍色實心：心理師此時段已有排到個案，並且諮商次數為0~6次",-1)})),h=c((function(){return Object(s["n"])("div",null,"紅色實心：心理師此時段已有排到個案，並且諮商次數為7~14次",-1)})),g=c((function(){return Object(s["n"])("div",null,"紫色實心：心理師此時段已有排到個案，並且諮商次數為15次以上",-1)})),v={class:"timetable-info"},p=Object(s["q"])("操作說明"),w={class:"result-table"},_={class:"result-aside"},y=c((function(){return Object(s["n"])("div",{style:{width:"100px",height:"1.3em","font-size":"0.9em","text-align":"center"}},"時段 \\ 日期",-1)})),k={class:"result-aside-label"},L={class:"result-table-inner"},D={class:"result-header"},K={class:"result-body"},C={class:"result-body-row"};function x(t,e,n,c,x,N){var X=Object(s["T"])("el-col"),S=Object(s["T"])("el-button"),R=Object(s["T"])("download-excel"),T=Object(s["T"])("el-row"),q=Object(s["T"])("InfoFilled"),A=Object(s["T"])("el-popover"),P=Object(s["T"])("resultBlock"),$=Object(s["U"])("loading");return Object(s["K"])(),Object(s["m"])("div",r,[Object(s["r"])(T,null,{default:Object(s["jb"])((function(){return[Object(s["r"])(X,{span:12},{default:Object(s["jb"])((function(){return[a,Object(s["kb"])(Object(s["n"])("select",{class:"labelSelector","onUpdate:modelValue":e[0]||(e[0]=function(e){return t.semesterLabel=e}),onChange:e[1]||(e[1]=function(t){return N.semesterLabelSelected()})},[i,(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(t.labelOption,(function(t){return Object(s["K"])(),Object(s["m"])("option",{key:t.label,value:t.label},Object(s["X"])(t.label),9,o)})),128))],544),[[s["eb"],t.semesterLabel]])]})),_:1}),Object(s["r"])(X,{span:12},{default:Object(s["jb"])((function(){return[Object(s["r"])(R,{data:N.downloadXLS(),fields:t.json_fields,name:"派案列表"+N.getDateStr(0)+".xls"},{default:Object(s["jb"])((function(){return[Object(s["r"])(S,{type:"success",size:"medium",style:{float:"right","margin-top":"30px"}},{default:Object(s["jb"])((function(){return[l]})),_:1})]})),_:1},8,["data","fields","name"]),Object(s["r"])(S,{type:"success",size:"medium",style:{float:"right","margin-top":"30px","margin-right":"10px"},onClick:e[2]||(e[2]=function(t){return N.downloadCSV()})},{default:Object(s["jb"])((function(){return[u]})),_:1})]})),_:1})]})),_:1}),Object(s["r"])(A,{placement:"bottom",title:"",width:400,trigger:"hover"},{reference:Object(s["jb"])((function(){return[Object(s["n"])("span",v,[p,Object(s["r"])(q,{style:{width:"1em",height:"1em",padding:"0 0 0 3px"}})])]})),default:Object(s["jb"])((function(){return[b,j,f,O,d,m,h,g]})),_:1}),Object(s["n"])("div",w,[Object(s["n"])("div",_,[y,(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(t.times,(function(t,e){return Object(s["K"])(),Object(s["m"])("div",k,Object(s["X"])(t.label),1)})),256))]),Object(s["kb"])((Object(s["K"])(),Object(s["m"])("div",L,[Object(s["n"])("div",D,[(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(N.getWeekAry(),(function(t){return Object(s["K"])(),Object(s["m"])("div",{class:Object(s["A"])(["result-header-col",N.isWeekend(t)?"strong-row":""])},Object(s["X"])(N.checkOffsetIsHoliday(t)?"假日":N.getDatetime(t)),3)})),256))]),Object(s["n"])("div",K,[(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(t.times,(function(e,n){return Object(s["K"])(),Object(s["m"])("div",C,[(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(N.getWeekAry(),(function(n){return Object(s["K"])(),Object(s["m"])("div",{class:Object(s["A"])(["result-body-col",N.isWeekend(n)?"strong-row":""])},[t.timetable[n%7]&&!N.checkOffsetIsHoliday(n)?(Object(s["K"])(),Object(s["m"])(s["b"],{key:0},[t.timetable[n%7].rows[e.value]?(Object(s["K"])(),Object(s["k"])(P,{key:0,results:t.timetable[n%7].rows[e.value].counselors,offset:n},null,8,["results","offset"])):Object(s["l"])("",!0)],64)):Object(s["l"])("",!0)],2)})),256))])})),256))])])),[[$,t.tableLoading]])])])}var N=n("5530"),X=n("c7eb"),S=n("1da1"),R=(n("4de4"),n("d3b7"),n("159b"),n("7db0"),n("b0c0"),n("ac1f"),n("1276"),n("d81d"),n("b64b"),n("a15b"),function(t){return Object(s["N"])("data-v-32bf13bc"),t=t(),Object(s["L"])(),t}),T={class:"resultBlock"},q=Object(s["q"])("未派案"),A={class:"content-title"},P=R((function(){return Object(s["n"])("div",null,"無資料",-1)})),$=Object(s["q"])("已派案"),F={class:"content-title",style:{color:"#F0F2F5"}},I={style:{color:"#F0F2F5"}},U=R((function(){return Object(s["n"])("br",null,null,-1)})),E={key:0,class:"block-container"},W={key:0,class:"more-block"},B={key:1,class:"block-container"},V={key:0,class:"more-block"},H={key:2,class:"block-container"},M={key:0,class:"more-block"},z={key:1,class:"more-block"};function J(t,e,n,c,r,a){var i=Object(s["T"])("el-col"),o=Object(s["T"])("el-row"),l=Object(s["T"])("el-popover");return Object(s["K"])(),Object(s["m"])("div",T,[Object(s["r"])(l,{placement:n.offset<10?"right":"left",title:a.getDatetime(n.offset),width:300,trigger:"click","hide-after":0},{reference:Object(s["jb"])((function(){return[r.unassignList.length<=0?(Object(s["K"])(),Object(s["m"])("div",E,[(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(r.assignList,(function(t,e){return Object(s["kb"])((Object(s["K"])(),Object(s["m"])("div",{class:Object(s["A"])(["divide-block-colored",a.getColor(a.addOffset(t.first_consultation_date))]),style:Object(s["B"])(r.assignList.length>r.showNum?"width: "+100/r.showNum+"%":"width: "+100/r.assignList.length+"%")},Object(s["X"])(t.counselor_name),7)),[[s["gb"],e<r.showNum]])})),256)),r.assignList.length>r.showNum?(Object(s["K"])(),Object(s["m"])("div",W,"+"+Object(s["X"])(r.assignList.length-r.showNum),1)):Object(s["l"])("",!0)])):r.assignList<=0?(Object(s["K"])(),Object(s["m"])("div",B,[(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(r.unassignList,(function(t,e){return Object(s["kb"])((Object(s["K"])(),Object(s["m"])("div",{class:"divide-block",style:Object(s["B"])(r.unassignList.length>r.showNum?"width: "+100/r.showNum+"%":"width: "+100/r.unassignList.length+"%")},Object(s["X"])(t),5)),[[s["gb"],e<r.showNum]])})),256)),r.unassignList.length>r.showNum?(Object(s["K"])(),Object(s["m"])("div",V,"+"+Object(s["X"])(r.unassignList.length-r.showNum),1)):Object(s["l"])("",!0)])):(Object(s["K"])(),Object(s["m"])("div",H,[(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(r.unassignList,(function(t,e){return Object(s["kb"])((Object(s["K"])(),Object(s["m"])("div",{class:"divide-block",style:Object(s["B"])(r.unassignList.length>r.showNum?"width: "+100/r.showNum+"0%":"width: "+100/r.unassignList.length+"%")},Object(s["X"])(t),5)),[[s["gb"],e<r.showNum]])})),256)),r.unassignList.length>r.showNum?(Object(s["K"])(),Object(s["m"])("div",M,"+"+Object(s["X"])(r.unassignList.length-r.showNum+r.assignList.length),1)):(Object(s["K"])(),Object(s["m"])("div",z,"+"+Object(s["X"])(r.assignList.length),1))]))]})),default:Object(s["jb"])((function(){return[Object(s["r"])(o,{class:"content-container",align:"middle"},{default:Object(s["jb"])((function(){return[Object(s["r"])(i,{class:"content-label",span:2},{default:Object(s["jb"])((function(){return[q]})),_:1}),Object(s["r"])(i,{span:22},{default:Object(s["jb"])((function(){return[(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(r.unassignList,(function(t,e){return Object(s["K"])(),Object(s["k"])(o,{align:"middle"},{default:Object(s["jb"])((function(){return[Object(s["r"])(i,{class:"content-idx",span:2},{default:Object(s["jb"])((function(){return[Object(s["q"])(Object(s["X"])(e+1),1)]})),_:2},1024),Object(s["r"])(i,{class:"content",span:22},{default:Object(s["jb"])((function(){return[Object(s["n"])("div",A,Object(s["X"])(t),1),P]})),_:2},1024)]})),_:2},1024)})),256))]})),_:1})]})),_:1}),Object(s["r"])(o,{class:"content-container",align:"middle"},{default:Object(s["jb"])((function(){return[Object(s["r"])(i,{class:"content-label",span:2},{default:Object(s["jb"])((function(){return[$]})),_:1}),Object(s["r"])(i,{span:22},{default:Object(s["jb"])((function(){return[(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(r.assignList,(function(t,e){return Object(s["K"])(),Object(s["k"])(o,{align:"middle"},{default:Object(s["jb"])((function(){return[Object(s["r"])(i,{class:Object(s["A"])(["content-idx",a.getColor(a.addOffset(t.first_consultation_date))]),span:2,style:{"line-height":"70px"}},{default:Object(s["jb"])((function(){return[Object(s["q"])(Object(s["X"])(e+1),1)]})),_:2},1032,["class"]),Object(s["r"])(i,{class:Object(s["A"])(["content",a.getColor(a.addOffset(t.first_consultation_date))]),span:22,style:{height:"70px"}},{default:Object(s["jb"])((function(){return[Object(s["n"])("div",F,Object(s["X"])(t.counselor_name),1),Object(s["n"])("div",I,[Object(s["q"])(Object(s["X"])(t.name)+" "+Object(s["X"])(t.caseId),1),U,Object(s["q"])("諮商次數："+Object(s["X"])(a.addOffset(t.first_consultation_date)),1)])]})),_:2},1032,["class"])]})),_:2},1024)})),256))]})),_:1})]})),_:1})]})),_:1},8,["placement","title"])])}var Y=n("b3e6"),G={mixins:[Y["a"]],props:["results","offset"],data:function(){return{unassignList:[],assignList:[],showNum:3}},mounted:function(){for(var t in this.results)if("unassign"==this.results[t])this.unassignList.push(t);else if(this.checkRangeDay(this.offset,this.results[t].end_consultation_date,this.results[t].first_consultation_date,this.results[t].status)){var e=this.results[t];this.assignList.push(e)}else this.unassignList.push(t)},methods:{getColor:function(t){return t>=15?"purple-block":t>=7?"red-block":t>=0?"blue-block":"gray-block"},getDatetime:function(t){var e=["（日）","（ㄧ）","（二）","（三）","（四）","（五）","（六）"],n=new Date;n.setDate(n.getDate()+t);var s=n.getFullYear()+" / "+(n.getMonth()+1)+" / "+n.getDate()+"  "+e[n.getDay()];return s},addOffset:function(t){var e=new Date;return e.setDate(e.getDate()+this.offset),this.countConsultationNumber(e,t)}}},Q=(n("fb14"),n("d959")),Z=n.n(Q);const tt=Z()(G,[["render",J],["__scopeId","data-v-32bf13bc"]]);var et=tt,nt=n("2ef0"),st=n.n(nt),ct={mixins:[Y["a"]],components:{resultBlock:et},inject:["reload"],data:function(){return{timetable:{},dayList:[],tableLoading:!1,json_fields:{"姓名":"name","學號":"caseId","學期標籤":"semester_label","諮商時段":"consultation_datetime","派案老師":"counselor_name","諮商開始時間":"first_consultation_date","危機程度":"crisis_level","初談老師":"init_counselor_name","狀態說明":"discription","初談時間":"init_consultation_date"},semesterLabel:"",labelOption:[]}},computed:{counselors:function(){var t=this;return console.log(this.semesterLabel),""!==this.semesterLabel?this.$store.state.counselors.filter((function(e){return e.semester_label===t.semesterLabel})):this.$store.state.counselors},assignCases:function(){var t=this,e=st.a.cloneDeep(this.$store.state.assignCases.data);return""!==this.semesterLabel?e.filter((function(e){return e.semester_label===t.semesterLabel})):e}},created:function(){var t=this;return Object(S["a"])(Object(X["a"])().mark((function e(){return Object(X["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("fetchHoliday");case 2:return e.next=4,t.$store.dispatch("fetchSemesterLabel");case 4:return t.labelOption=t.$store.state.semester_label.data,t.semesterLabel=t.$route.query.semesterLabel?t.$route.query.semesterLabel:t.labelOption[0].label,t.tableLoading=!0,e.next=9,t.$store.dispatch("fetchAssignCases");case 9:return e.next=11,t.$store.dispatch("fetchCounselors");case 11:t.createResultTable(),t.tableLoading=!1,console.log(t.timetable);case 14:case"end":return e.stop()}}),e)})))()},methods:{semesterLabelSelected:function(){this.$router.push({path:"",query:{semesterLabel:this.semesterLabel}}),this.reload()},createResultTable:function(){var t=this;console.log(this.counselors),this.timetable={};for(var e=function(e){s=["U","M","T","W","R","F","S"],c=new Date,c.setDate(c.getDate()+e);var n=s[c.getDay()];"U"!=n&&"S"!=n&&(t.dayList.push({name:n,offset:e}),t.timetable[e]={rows:{}},t.counselors.forEach((function(s){var c=s.available_time.split(",");c.forEach((function(c){c.indexOf(n)>=0&&(t.timetable[e].rows[c.charAt(1)]||(t.timetable[e].rows[c.charAt(1)]={counselors:{}}),t.timetable[e].rows[c.charAt(1)].counselors[s.name]="unassign")}))})))},n=0;n<=7;n++){var s,c;e(n)}this.assignCases.forEach((function(e){var n=t.dayList.find((function(t){return t.name==e.consultation_day}));t.timetable[n.offset].rows[e.consultation_time]&&(t.timetable[n.offset].rows[e.consultation_time].counselors[e.counselor_name]=e)}))},isWeekend:function(t){var e=new Date;return e.setDate(e.getDate()+t),5==e.getDay()},getDatetime:function(t){var e=["（日）","（ㄧ）","（二）","（三）","（四）","（五）","（六）"],n=new Date;n.setDate(n.getDate()+t);var s=n.getMonth()+1+" / "+n.getDate()+"  "+e[n.getDay()];return s},getDateStr:function(t){var e=new Date;return e.setDate(e.getDate()+t),e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},getWeekAry:function(){for(var t=[],e=new Date,n=1;n<85;n++){var s=new Date;s.setDate(e.getDate()+n),0!=s.getDay()&&6!=s.getDay()&&t.push(n)}return t},downloadXLS:function(){for(var t=this,e=st.a.cloneDeep(this.assignCases),n=function(n){e[n].consultation_datetime="星期"+t.days.find((function(t){return t.value==e[n].consultation_day})).label+" "+t.times.find((function(t){return t.value==e[n].consultation_time})).label},s=0;s<e.length;s++)n(s);return e},downloadCSV:function(){var t=st.a.cloneDeep(this.assignCases),e=this.convertCases(t),n=this.buildCSVContent(e),s=encodeURI(n);window.open(s)},formatConsultationDateTime:function(t){console.log(t);var e=this.days.find((function(e){return e.value==t.consultation_day})),n=this.times.find((function(e){return e.value==t.consultation_time})),s=e?e.label:"Unknown day",c=n?n.label:"Unknown time";return"星期"+s+" "+c},convertCases:function(t){var e=this;return t.map((function(t){return Object(N["a"])(Object(N["a"])({},t),{},{consultation_datetime:e.formatConsultationDateTime(t),init_consultation_date:e.convertUTCtoStr(t.init_consultation_date)})}))},buildRow:function(t){var e=this;return Object.keys(this.json_fields).map((function(n){return t[e.json_fields[n]]}))},buildCSVContent:function(t){var e=this,n=[Object.keys(this.json_fields)];return t.forEach((function(t){n.push(e.buildRow(t))})),"data:text/csv;charset=utf-8,"+n.map((function(t){return t.join(",")})).join("\r\n")},checkOffsetIsHoliday:function(t){var e=new Date;return e.setDate(e.getDate()+t),this.checkHoliday(e)}}};n("5dca");const rt=Z()(ct,[["render",x],["__scopeId","data-v-75fe07af"]]);e["default"]=rt},5530:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));n("b64b"),n("a4d3"),n("4de4"),n("d3b7"),n("e439"),n("159b"),n("dbb4");function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}},"5dca":function(t,e,n){"use strict";n("367f")},dbb4:function(t,e,n){var s=n("23e7"),c=n("83ab"),r=n("56ef"),a=n("fc6a"),i=n("06cf"),o=n("8418");s({target:"Object",stat:!0,sham:!c},{getOwnPropertyDescriptors:function(t){var e,n,s=a(t),c=i.f,l=r(s),u={},b=0;while(l.length>b)n=c(s,e=l[b++]),void 0!==n&&o(u,e,n);return u}})},e439:function(t,e,n){var s=n("23e7"),c=n("d039"),r=n("fc6a"),a=n("06cf").f,i=n("83ab"),o=c((function(){a(1)})),l=!i||o;s({target:"Object",stat:!0,forced:l,sham:!i},{getOwnPropertyDescriptor:function(t,e){return a(r(t),e)}})},fb14:function(t,e,n){"use strict";n("494e")}}]);
//# sourceMappingURL=chunk-76ec1784.c79c69ac.js.map