(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-abe9db4c"],{"04d1":function(e,t,n){var s=n("342f"),i=s.match(/firefox\/(\d+)/i);e.exports=!!i&&+i[1]},"07ac":function(e,t,n){var s=n("23e7"),i=n("6f53").values;s({target:"Object",stat:!0},{values:function(e){return i(e)}})},"083a":function(e,t,n){"use strict";var s=n("0d51"),i=TypeError;e.exports=function(e,t){if(!delete e[t])throw i("Cannot delete property "+s(t)+" of "+s(e))}},"366f":function(e,t,n){},"4e82":function(e,t,n){"use strict";var s=n("23e7"),i=n("e330"),a=n("59ed"),r=n("7b0b"),o=n("07fa"),c=n("083a"),l=n("577e"),u=n("d039"),b=n("addb"),f=n("a640"),d=n("04d1"),m=n("d998"),j=n("2d00"),h=n("512c"),g=[],O=i(g.sort),p=i(g.push),v=u((function(){g.sort(void 0)})),_=u((function(){g.sort(null)})),k=f("sort"),y=!u((function(){if(j)return j<70;if(!(d&&d>3)){if(m)return!0;if(h)return h<603;var e,t,n,s,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(s=0;s<47;s++)g.push({k:t+s,v:n})}for(g.sort((function(e,t){return t.v-e.v})),s=0;s<g.length;s++)t=g[s].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}})),C=v||!_||!k||!y,w=function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:l(t)>l(n)?1:-1}};s({target:"Array",proto:!0,forced:C},{sort:function(e){void 0!==e&&a(e);var t=r(this);if(y)return void 0===e?O(t):O(t,e);var n,s,i=[],l=o(t);for(s=0;s<l;s++)s in t&&p(i,t[s]);b(i,w(e)),n=i.length,s=0;while(s<n)t[s]=i[s++];while(s<l)c(t,s++);return t}})},"512c":function(e,t,n){var s=n("342f"),i=s.match(/AppleWebKit\/(\d+)\./);e.exports=!!i&&+i[1]},5530:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n("b64b"),n("a4d3"),n("4de4"),n("d3b7"),n("e439"),n("159b"),n("dbb4");function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},"561c":function(e,t,n){},6229:function(e,t,n){"use strict";n("f745")},8111:function(e,t,n){"use strict";var s=n("7a23");function i(e,t,n,i,a,r){return Object(s["K"])(),Object(s["m"])("div",{class:"semester_label_tag",style:Object(s["B"])(r.getStyleForLabel(n.label))},Object(s["X"])(n.label),5)}var a=n("c7eb"),r=n("1da1"),o=(n("7db0"),n("d3b7"),n("99af"),{props:{label:{type:String,required:!0}},data:function(){return{labelOptions:[]}},created:function(){var e=this;return Object(r["a"])(Object(a["a"])().mark((function t(){return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(e.$store.state.semester_label.length<=0)){t.next=3;break}return t.next=3,e.$store.dispatch("fetchSemesterLabel");case 3:e.labelOptions=e.$store.state.semester_label.data;case 4:case"end":return t.stop()}}),t)})))()},methods:{getLabelColor:function(e){var t=this.labelOptions.find((function(t){return t.label===e}));return t?t.color:"defaultColor"},getStyleForLabel:function(e){var t=this.getLabelColor(e);return"background-color: ".concat(t,"44; color: ").concat(t,"; border: 1px solid ").concat(t)}}}),c=(n("cfff"),n("d959")),l=n.n(c);const u=l()(o,[["render",i]]);t["a"]=u},a434:function(e,t,n){"use strict";var s=n("23e7"),i=n("7b0b"),a=n("23cb"),r=n("5926"),o=n("07fa"),c=n("3511"),l=n("65f0"),u=n("8418"),b=n("083a"),f=n("1dde"),d=f("splice"),m=Math.max,j=Math.min;s({target:"Array",proto:!0,forced:!d},{splice:function(e,t){var n,s,f,d,h,g,O=i(this),p=o(O),v=a(e,p),_=arguments.length;for(0===_?n=s=0:1===_?(n=0,s=p-v):(n=_-2,s=j(m(r(t),0),p-v)),c(p+n-s),f=l(O,s),d=0;d<s;d++)h=v+d,h in O&&u(f,d,O[h]);if(f.length=s,n<s){for(d=v;d<p-s;d++)h=d+s,g=d+n,h in O?O[g]=O[h]:b(O,g);for(d=p;d>p-s+n;d--)b(O,d-1)}else if(n>s)for(d=p-s;d>v;d--)h=d+s-1,g=d+n-1,h in O?O[g]=O[h]:b(O,g);for(d=0;d<n;d++)O[d+v]=arguments[d+2];return O.length=p-s+n,f}})},addb:function(e,t,n){var s=n("4dae"),i=Math.floor,a=function(e,t){var n=e.length,c=i(n/2);return n<8?r(e,t):o(e,a(s(e,0,c),t),a(s(e,c),t),t)},r=function(e,t){var n,s,i=e.length,a=1;while(a<i){s=a,n=e[a];while(s&&t(e[s-1],n)>0)e[s]=e[--s];s!==a++&&(e[s]=n)}return e},o=function(e,t,n,s){var i=t.length,a=n.length,r=0,o=0;while(r<i||o<a)e[r+o]=r<i&&o<a?s(t[r],n[o])<=0?t[r++]:n[o++]:r<i?t[r++]:n[o++];return e};e.exports=a},cfff:function(e,t,n){"use strict";n("561c")},d80f:function(e,t,n){"use strict";n.r(t);n("d3b7"),n("ac1f"),n("1276");var s=n("7a23"),i=function(e){return Object(s["N"])("data-v-c1db902e"),e=e(),Object(s["L"])(),e},a={class:"page-container"},r={class:"page-title-container"},o={class:"flex-half"},c=i((function(){return Object(s["n"])("div",{class:"page-title"},"尚待派案學生列表",-1)})),l=i((function(){return Object(s["n"])("span",null,"派案學期：",-1)})),u=i((function(){return Object(s["n"])("option",{value:""},"請選擇或輸入學期標籤",-1)})),b=["value"],f={class:"flex-half",style:{"padding-left":"7px"}},d=i((function(){return Object(s["n"])("span",{class:"page-title"},"初排結果",-1)})),m=i((function(){return Object(s["n"])("strong",null,"操作方式",-1)})),j=i((function(){return Object(s["n"])("div",null,"拖曳左側為派案個案、或是灰色實心方塊調整心理師與時段",-1)})),h=i((function(){return Object(s["n"])("br",null,null,-1)})),g=i((function(){return Object(s["n"])("strong",null,"方塊顏色意義",-1)})),O=i((function(){return Object(s["n"])("div",null,"灰色空格：心理師此時段為有空",-1)})),p=i((function(){return Object(s["n"])("div",null,"灰色實心：初排將此時段配對到一個新的個案",-1)})),v=i((function(){return Object(s["n"])("div",null,"藍色實心：心理師此時段已有排到個案，並且諮商次數為0~6次",-1)})),_=i((function(){return Object(s["n"])("div",null,"紅色實心：心理師此時段已有排到個案，並且諮商次數為7~14次",-1)})),k=i((function(){return Object(s["n"])("div",null,"紫色實心：心理師此時段已有排到個案，並且諮商次數為15次以上",-1)})),y={class:"timetable-info"},C=Object(s["q"])("操作說明"),w={class:"assign-save",style:{padding:"17px 0"}},T=Object(s["q"])("儲存修改"),D=["innerHTML"],L={key:0},x={key:2,class:"drag-body-wrap-item"},S={class:"assign-table",ref:"assignTable"},I=i((function(){return Object(s["n"])("div",{class:"slopeline"},[Object(s["n"])("div",{class:"slope-label slope-label-1"},"姓名"),Object(s["n"])("div",{class:"slope-label slope-label-2"},"時段")],-1)})),E={class:"row-bar assign-header-label",span:2},K=Object(s["q"])("假日"),$={class:"row-bar unavailable",span:2},R=i((function(){return Object(s["n"])("h3",null,"本次新增派案",-1)})),q=Object(s["q"])("下載Excel"),P=Object(s["q"])("下載CSV"),M=["innerHTML"],X=Object(s["q"])("諮商時段"),A={class:"dialog-footer",slot:"footer",style:{"text-align":"center"}},H=Object(s["q"])("關閉");function B(e,t,n,i,B,V){var F=Object(s["T"])("InfoFilled"),N=Object(s["T"])("el-popover"),U=Object(s["T"])("el-button"),z=Object(s["T"])("QuestionFilled"),W=Object(s["T"])("el-col"),J=Object(s["T"])("el-row"),Y=Object(s["T"])("SemesterLabelTag"),G=Object(s["T"])("el-tag"),Q=Object(s["T"])("timeBlock"),Z=Object(s["T"])("download-excel"),ee=Object(s["T"])("el-table-column"),te=Object(s["T"])("el-table"),ne=Object(s["T"])("el-dialog"),se=Object(s["U"])("loading");return Object(s["K"])(),Object(s["m"])("div",a,[Object(s["n"])("div",r,[Object(s["n"])("div",o,[c,Object(s["n"])("div",null,[l,Object(s["kb"])(Object(s["n"])("select",{class:"labelSelector","onUpdate:modelValue":t[0]||(t[0]=function(e){return B.semesterLabel=e}),onChange:t[1]||(t[1]=function(e){return V.semesterLabelSelected()})},[u,(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(B.labelOption,(function(e){return Object(s["K"])(),Object(s["m"])("option",{key:e.label,value:e.label},Object(s["X"])(e.label),9,b)})),128))],544),[[s["eb"],B.semesterLabel]])])]),Object(s["n"])("div",f,[Object(s["n"])("div",null,[d,Object(s["r"])(N,{placement:"bottom",title:"",width:400,trigger:"hover"},{reference:Object(s["jb"])((function(){return[Object(s["n"])("span",y,[C,Object(s["r"])(F,{style:{width:"1em",height:"1em",padding:"0 0 0 3px"}})])]})),default:Object(s["jb"])((function(){return[m,j,h,g,O,p,v,_,k]})),_:1})]),Object(s["n"])("div",w,[Object(s["r"])(U,{size:"large",type:"warning",onClick:t[2]||(t[2]=function(e){return V.submitChange()})},{default:Object(s["jb"])((function(){return[T]})),_:1})])])]),Object(s["kb"])((Object(s["K"])(),Object(s["k"])(J,{gutter:10},{default:Object(s["jb"])((function(){return[Object(s["r"])(W,{sm:24,md:12},{default:Object(s["jb"])((function(){return[Object(s["n"])("div",{class:"drag-table drag-container",onDrop:t[3]||(t[3]=function(){return V.drop&&V.drop.apply(V,arguments)}),onDragover:t[4]||(t[4]=function(){return V.allowDrop&&V.allowDrop.apply(V,arguments)}),ref:"dragBody",id:"dragBody"},[Object(s["r"])(J,{class:"drag-header"},{default:Object(s["jb"])((function(){return[(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(B.headerLabel,(function(t){return Object(s["K"])(),Object(s["k"])(W,{class:"drag-header-col",span:"可諮商時段"==t?6:3},{default:Object(s["jb"])((function(){return[Object(s["q"])(Object(s["X"])(t),1),"可諮商時段"==t?(Object(s["K"])(),Object(s["k"])(N,{key:0,placement:"right",title:"",width:200,trigger:"hover","popper-class":"weektimePop"},{reference:Object(s["jb"])((function(){return[Object(s["r"])(z,{style:{width:"1em",height:"1em",padding:"0 0 0 3px"}})]})),default:Object(s["jb"])((function(){return[Object(s["n"])("div",{innerHTML:e.getHtmlContent()},null,8,D)]})),_:1})):Object(s["l"])("",!0)]})),_:2},1032,["span"])})),256))]})),_:1}),(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(B.unassignCases,(function(t,n){return Object(s["K"])(),Object(s["k"])(J,{draggable:"unassign"==t.status,onDragstart:V.drag,id:"drag-"+t.id,class:Object(s["A"])("unassign"==t.status?"drag-body-row":"undrag-container")},{default:Object(s["jb"])((function(){return[(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(B.headerName,(function(n){return Object(s["K"])(),Object(s["k"])(W,{class:"drag-body-col",span:"available_time"==n?6:3},{default:Object(s["jb"])((function(){return["init_consultation_date"==n?(Object(s["K"])(),Object(s["m"])("div",L,Object(s["X"])(e.convertUTCtoStr(t[n])),1)):"semester_label"==n?(Object(s["K"])(),Object(s["k"])(Y,{key:1,label:t[n]},null,8,["label"])):(Object(s["K"])(),Object(s["m"])("div",x,Object(s["X"])(t[n]),1))]})),_:2},1032,["span"])})),256))]})),_:2},1032,["draggable","onDragstart","id","class"])})),256))],544)]})),_:1}),Object(s["r"])(W,{sm:24,md:12},{default:Object(s["jb"])((function(){return[Object(s["n"])("div",S,[Object(s["r"])(J,{class:"assign-header",style:Object(s["B"])("width: "+B.tableWidth+"px")},{default:Object(s["jb"])((function(){return[Object(s["r"])(W,{span:3},{default:Object(s["jb"])((function(){return[I]})),_:1}),Object(s["r"])(W,{class:"assign-col-container",span:21},{default:Object(s["jb"])((function(){return[(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(e.times,(function(e){return Object(s["K"])(),Object(s["m"])("div",E,Object(s["X"])(e.label.split("~")[0]),1)})),256))]})),_:1})]})),_:1},8,["style"]),Object(s["r"])(J,{class:"assign-body"},{default:Object(s["jb"])((function(){return[(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(B.dayList,(function(n,i){return Object(s["K"])(),Object(s["m"])(s["b"],null,[Object(s["r"])(W,{class:"assign-date",span:24},{default:Object(s["jb"])((function(){return[Object(s["q"])(Object(s["X"])(V.getDatetime(n.offset)),1),B.timetable[n.offset].isHoliday?(Object(s["K"])(),Object(s["k"])(G,{key:0,class:"mx-1",type:"danger",size:"mini",effect:"dark",round:""},{default:Object(s["jb"])((function(){return[K]})),_:1})):Object(s["l"])("",!0)]})),_:2},1024),(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(B.timetable[n.offset].rows,(function(i,a){return Object(s["K"])(),Object(s["m"])(s["b"],null,[B.timetable[n.offset].isHoliday?Object(s["l"])("",!0):(Object(s["K"])(),Object(s["m"])(s["b"],{key:0},[Object(s["r"])(W,{class:"assign-aside-label col-bar",span:3},{default:Object(s["jb"])((function(){return[Object(s["n"])("div",null,Object(s["X"])(i.counselor_name),1)]})),_:2},1024),Object(s["r"])(W,{class:"assign-col-container col-bar",span:21},{default:Object(s["jb"])((function(){return[(Object(s["K"])(!0),Object(s["m"])(s["b"],null,Object(s["R"])(e.times,(function(r){return Object(s["K"])(),Object(s["m"])("div",$,[i.block[r.value]?(Object(s["K"])(),Object(s["k"])(Q,{key:0,class:"drag-container",block:i.block[r.value],pos:n.offset+"-"+a+"-"+r.value,onAddTimeblock:function(e){return V.addTimeblock(e,n.offset,a,r.value)},onRemoveTimeblock:V.removeTimeblock,onSetDragPos:V.setDragPos,onEndCase:t[5]||(t[5]=function(t){return V.endCase(t,e.data)}),onReturnCase:t[6]||(t[6]=function(t){return V.returnCase(t,e.data)})},null,8,["block","pos","onAddTimeblock","onRemoveTimeblock","onSetDragPos"])):Object(s["l"])("",!0)])})),256))]})),_:2},1024)],64))],64)})),256))],64)})),256))]})),_:1})],512)]})),_:1})]})),_:1})),[[se,B.loading]]),Object(s["r"])(ne,{title:"儲存成功",modelValue:B.dialogVisible,"onUpdate:modelValue":t[9]||(t[9]=function(e){return B.dialogVisible=e}),width:"60%",onClose:V.handleClose,center:""},{default:Object(s["jb"])((function(){return[Object(s["r"])(J,null,{default:Object(s["jb"])((function(){return[Object(s["r"])(W,{span:12},{default:Object(s["jb"])((function(){return[R]})),_:1}),Object(s["r"])(W,{span:12},{default:Object(s["jb"])((function(){return[Object(s["r"])(Z,{data:V.downloadXLS(),fields:B.json_fields,name:V.getDateStr(0)+"新增派案.xls"},{default:Object(s["jb"])((function(){return[Object(s["r"])(U,{type:"success",size:"medium",style:{float:"right","margin-right":"40px"}},{default:Object(s["jb"])((function(){return[q]})),_:1})]})),_:1},8,["data","fields","name"]),Object(s["r"])(U,{type:"success",size:"medium",style:{float:"right","margin-right":"40px"},onClick:t[7]||(t[7]=function(e){return V.downloadCSV()})},{default:Object(s["jb"])((function(){return[P]})),_:1})]})),_:1})]})),_:1}),Object(s["r"])(te,{data:V.assigningCases,style:{width:"100%"}},{default:Object(s["jb"])((function(){return[Object(s["r"])(ee,{prop:"name",label:"姓名"}),Object(s["r"])(ee,{prop:"caseId",label:"學號"}),Object(s["r"])(ee,{prop:"semester_label",label:"學期標籤"}),Object(s["r"])(ee,{label:"諮商時段"},{header:Object(s["jb"])((function(){return[Object(s["r"])(N,{placement:"right",title:"",width:200,trigger:"hover","popper-class":"weektimePop"},{reference:Object(s["jb"])((function(){return[Object(s["n"])("span",null,[X,Object(s["r"])(z,{style:{width:"1em",height:"1em",padding:"0 0 0 3px"}})])]})),default:Object(s["jb"])((function(){return[Object(s["n"])("div",{innerHTML:e.getHtmlContent()},null,8,M)]})),_:1})]})),default:Object(s["jb"])((function(e){return[Object(s["n"])("div",null,Object(s["X"])(e.row.consultation_day+e.row.consultation_time),1)]})),_:1}),Object(s["r"])(ee,{prop:"counselor_name",label:"派案老師"}),Object(s["r"])(ee,{prop:"first_consultation_date",label:"諮商開始時間"}),Object(s["r"])(ee,{prop:"crisis_level",label:"危機程度"}),Object(s["r"])(ee,{prop:"init_counselor_name",label:"初談老師"}),Object(s["r"])(ee,{prop:"discription",label:"狀態說明"}),Object(s["r"])(ee,{prop:"init_consultation_date",label:"初談時間"},{default:Object(s["jb"])((function(t){return[Object(s["n"])("div",null,Object(s["X"])(e.convertUTCtoStr(t.row.init_consultation_date)),1)]})),_:1})]})),_:1},8,["data"]),Object(s["n"])("div",A,[Object(s["r"])(U,{type:"danger",onClick:t[8]||(t[8]=function(e){return B.dialogVisible=!1})},{default:Object(s["jb"])((function(){return[H]})),_:1})])]})),_:1},8,["modelValue","onClose"])])}var V=n("5530"),F=n("c7eb"),N=n("1da1"),U=(n("4de4"),n("159b"),n("4e82"),n("b0c0"),n("99af"),n("a15b"),n("a434"),n("07ac"),n("b64b"),n("7db0"),n("d81d"),function(e){return Object(s["N"])("data-v-fb8ff7f0"),e=e(),Object(s["L"])(),e}),z={key:0,class:"block-container unassign",ref:"blockContainer"},W={key:1},J=["innerHTML"],Y=["draggable","id"],G=U((function(){return Object(s["n"])("br",null,null,-1)})),Q=["innerHTML"],Z={style:{display:"flex","justify-content":"center"}},ee=Object(s["q"])("取消派案"),te={class:"assign-block"},ne=U((function(){return Object(s["n"])("br",null,null,-1)}));function se(e,t,n,i,a,r){var o=this,c=Object(s["T"])("el-popover"),l=Object(s["T"])("el-button");return Object(s["K"])(),Object(s["m"])("div",null,["unassign"==n.block?(Object(s["K"])(),Object(s["m"])("div",z,[Object(s["n"])("div",{class:"unassign-block droggable-block",onDrop:t[0]||(t[0]=function(){return r.drop&&r.drop.apply(r,arguments)}),onDragover:t[1]||(t[1]=function(){return r.allowDrop&&r.allowDrop.apply(r,arguments)})},"未指派",32)],512)):"assigning"==n.block.status?(Object(s["K"])(),Object(s["m"])("div",W,[Object(s["r"])(c,{placement:n.block.consultation_time>=7?"left":"right",title:n.block.name,width:200,trigger:"click","hide-after":0,disabled:"unassign"==n.block},{reference:Object(s["jb"])((function(){return[Object(s["n"])("div",{class:Object(s["A"])(["block-container draggable-block assign-block",r.getColor()]),onClick:t[3]||(t[3]=function(e){return n.block.isLater?r.clikeLaterBlock():""})},[Object(s["n"])("div",{draggable:!n.block.isLater,onDragstart:t[2]||(t[2]=function(){return r.drag&&r.drag.apply(r,arguments)}),id:"drag-"+n.block.id},[Object(s["q"])(Object(s["X"])(n.block.name)+" ",1),G,Object(s["q"])(" （"+Object(s["X"])(n.block.consultation_number)+"）",1)],40,Y)],2)]})),default:Object(s["jb"])((function(){return[Object(s["n"])("div",{innerHTML:r.formatContent()},null,8,J)]})),_:1},8,["placement","title","disabled"])])):(Object(s["K"])(),Object(s["m"])("div",{key:2,class:Object(s["A"])(["block-container",r.getColor()])},[Object(s["r"])(c,{placement:n.block.consultation_time>=7?"left":"right",title:n.block.name,width:200,trigger:"click","hide-after":0,disabled:"unassign"==n.block},{reference:Object(s["jb"])((function(){return[Object(s["n"])("div",te,[Object(s["q"])(Object(s["X"])(n.block.name)+" ",1),ne,Object(s["q"])(" （"+Object(s["X"])(n.block.consultation_number)+"）",1)])]})),default:Object(s["jb"])((function(){return[Object(s["n"])("div",{innerHTML:r.formatContent()},null,8,Q),Object(s["n"])("div",Z,[Object(s["r"])(l,{type:"warning",size:"small",style:{margin:"5px 10px"},onClick:t[4]||(t[4]=function(e){return o.$emit("returnCase",n.block)})},{default:Object(s["jb"])((function(){return[ee]})),_:1}),Object(s["r"])(l,{type:"danger",size:"small",style:{margin:"5px 10px"},onClick:t[5]||(t[5]=function(e){return r.clickEnd()}),disabled:"closed"==n.block.status},{default:Object(s["jb"])((function(){return[Object(s["q"])(Object(s["X"])("closed"==n.block.status?"已結案":"結案"),1)]})),_:1},8,["disabled"])])]})),_:1},8,["placement","title","disabled"])],2))])}var ie={props:["block","pos"],data:function(){return{}},methods:{getColor:function(){return"closed"==this.block.status?"black-block":"reserve"==this.block.status?"aliceblue-block":"assign"!=this.block.status?this.block.isLater?"darker-gray-block":"gray-block":this.block.consultation_number>=15?"purple-block":this.block.consultation_number>=7?"red-block":this.block.consultation_number>=1?"blue-block":void 0},formatContent:function(){return"\n            學號：".concat(this.block.caseId," <br>\n            初談時間：").concat(this.getDateStr(this.block.init_consultation_date),"<br>\n            危機程度：").concat(this.block.crisis_level," <br>\n            狀況說明：").concat(this.block.discription," <br>\n            學期標籤：").concat(this.block.semester_label," <br>\n            諮商時段：").concat(this.block.consultation_day+this.block.consultation_time," <br>\n            派案老師：").concat(this.block.counselor_name," <br>\n            諮商次數：").concat(this.block.consultation_number,"<br>\n            開始諮商：").concat(this.getDateStr(this.block.first_consultation_date),"<br>\n            ").concat("closed"==this.block.status?"結束諮商："+this.getDateStr(this.block.end_consultation_date):"","\n            ")},allowDrop:function(e){e.preventDefault()},drag:function(e){e.dataTransfer.setData("text",e.target.id),this.$emit("setDragPos",this.pos)},drop:function(e){e.preventDefault();var t=e.dataTransfer.getData("text");e.target.classList.contains("drag-container")?e.target.appendChild(document.getElementById(t)):e.target.classList.contains("unassign-block")?(this.$emit("removeTimeblock",{id:t.split("-")[1]}),this.$emit("addTimeblock",t.split("-")[1])):document.querySelector("#dragBody").appendChild(document.getElementById(t))},getDateStr:function(e){var t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()},clikeLaterBlock:function(){this.$message({showClose:!0,message:"請移動一週前此時段的區塊來調整時間",duration:5e3})},clickEnd:function(){var e=this.block;e.offset=parseInt(this.pos.split("-")[0]),this.$emit("endCase",e)}}},ae=(n("e04c"),n("d959")),re=n.n(ae);const oe=re()(ie,[["render",se],["__scopeId","data-v-fb8ff7f0"]]);var ce=oe,le=n("b3e6"),ue=n("8111"),be=n("2ef0"),fe=n.n(be),de={mixins:[le["a"]],components:{timeBlock:ce,SemesterLabelTag:ue["a"]},inject:["reload"],data:function(){return{dialogVisible:!1,headerLabel:["學號","姓名","學期標籤","可諮商時段","危機程度","狀態說明","初談時間"],headerName:["caseId","name","semester_label","available_time","crisis_level","discription","init_consultation_date"],assignCases:[],unassignCases:[],timetable:{},tableWidth:0,dragPos:"",dayList:[],emptyTimeList:[],finalTimeInfo:[],loading:!0,json_fields:{"姓名":"name","學號":"caseId","學期標籤":"semester_label","諮商時段":"consultation_datetime","派案老師":"counselor_name","諮商開始時間":"first_consultation_date","危機程度":"crisis_level","初談老師":"init_counselor_name","狀態說明":"discription","初談時間":"init_consultation_date"},semesterLabel:"",labelOption:"",sortRule:"sortRule",sortScore:{crisis_level:{labelNumber:{A:1e3,B:100,C:0},levelNumber:{"+":0,"-":0}},time:{labelNumber:{A:0,B:0,C:0},levelNumber:{"+":0,"-":0}}}}},created:function(){var e=this;return Object(N["a"])(Object(F["a"])().mark((function t(){return Object(F["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("fetchHoliday");case 2:return t.next=4,e.$store.dispatch("fetchSemesterLabel");case 4:return e.labelOption=e.$store.state.semester_label.data,e.sortRule=e.$route.query.sort_rule?e.$route.query.sort_rule:"crisis_level",e.semesterLabel=e.$route.query.semesterLabel?e.$route.query.semesterLabel:e.labelOption[0].label,t.next=9,e.$store.dispatch("fetchAssignCases");case 9:return t.next=11,e.$store.dispatch("fetchCounselors");case 11:return t.next=13,e.$store.dispatch("fetchUnassignCases");case 13:e.timetable=e.createTimeTable(),console.log(e.timetable);case 15:case"end":return t.stop()}}),t)})))()},computed:{assigningCases:function(){return this.unassignCases.filter((function(e){return"assigning"==e.status}))},counselors:function(){var e=this;return console.log(this.semesterLabel),""!==this.semesterLabel?this.$store.state.counselors.filter((function(t){return t.semester_label===e.semesterLabel})):this.$store.state.counselors}},mounted:function(){var e=this.$refs.assignTable.clientWidth;this.tableWidth=e},methods:{semesterLabelSelected:function(){this.$router.push({path:"",query:{semesterLabel:this.semesterLabel}}),this.reload()},pushSortRule:function(){this.$router.push({path:"",query:{sort_rule:this.sortRule}}),this.reload()},sortCases:function(e){var t=new Date,n=864e5;this.sortRule=this.$route.query.sort_rule?this.$route.query.sort_rule:"crisis_level";var s=this.sortScore[this.sortRule]["labelNumber"],i=this.sortScore[this.sortRule]["levelNumber"];e.forEach((function(e){var a=0;for(var r in s)e.crisis_level.indexOf(r)>=0&&(a+=s[r]);for(var o in i)e.crisis_level.indexOf(o)>=0&&(a+=i[o]);e.score=a;var c=new Date(e.init_consultation_date),l=Math.ceil(Math.abs(t-c)/n);e.score+=l})),e.sort((function(e,t){return e.score>t.score?-1:e.score<t.score?1:0}))},createTimeTable:function(){var e=this;this.unassignCases=fe.a.cloneDeep(this.$store.state.unassignCases),this.unassignCases=this.unassignCases.filter((function(t){return t.semester_label===e.semesterLabel})),this.sortCases(this.unassignCases),this.assignCases=fe.a.cloneDeep(this.$store.state.assignCases.data);for(var t={},n=function(n){i=["U","M","T","W","R","F","S"],a=new Date,a.setDate(a.getDate()+n);var s=i[a.getDay()];if("U"!=s&&"S"!=s){var o=e.checkHoliday(a);e.dayList.push({name:s,offset:n}),r={},e.counselors.forEach((function(t){if(t.available_time.indexOf(s)>=0){for(var i=t.available_time.split(","),a={},c=0;c<i.length;c++)if(i[c].indexOf(s)>=0){var l=i[c].substr(i[c].length-1);a[l]="unassign",o||e.emptyTimeList.unshift("".concat(s).concat(l,"-").concat(n,"-").concat(t.name))}r[t.name]={counselor_name:t.name,block:a}}})),t[n]={offset:n,rows:r,isHoliday:!!o}}},s=8;s>=0;s--){var i,a,r;n(s)}if(this.assignCases&&this.assignCases.forEach((function(n){var s=e.dayList.filter((function(e){return e.name==n.consultation_day}));s.forEach((function(s){if(t[s.offset].rows[n.counselor_name]||(t[s.offset].rows[n.counselor_name]={block:{}}),e.checkRangeDay(s.offset,n.end_consultation_date,n.first_consultation_date,n.status)){var i=fe.a.cloneDeep(n);t[s.offset].rows[n.counselor_name].block[n.consultation_time]=i,t[s.offset].rows[n.counselor_name].block[n.consultation_time].consultation_number=e.countConsultationNumber(e.getDateStr(s.offset),i.first_consultation_date),e.emptyTimeList=e.removeEmptyTimeList(e.emptyTimeList,s.name,i.consultation_time,s.offset,i.counselor_name)}else if(e.checkReserve(s.offset,n.first_consultation_date)){var a=fe.a.cloneDeep(n);t[s.offset].rows[n.counselor_name].block[n.consultation_time]=a,t[s.offset].rows[n.counselor_name].block[n.consultation_time].consultation_number=0,t[s.offset].rows[n.counselor_name].block[n.consultation_time].status="reserve",e.emptyTimeList=e.removeEmptyTimeList(e.emptyTimeList,s.name,a.consultation_time,s.offset,a.counselor_name)}}))})),this.emptyTimeList=this.clearRepeatTime(fe.a.cloneDeep(this.emptyTimeList)),this.unassignCases.length>0){var o={timeInfo:"",fit_time:this.fitEmptyTimeList(this.unassignCases[0].available_time,this.emptyTimeList),remain_time:this.emptyTimeList};this.makeTree(o,0);var c=0;while(this.finalTimeInfo.length>0)"unassign"==this.finalTimeInfo[0]||"undefined"==this.finalTimeInfo[0]?this.finalTimeInfo.shift():function(){var n=e.finalTimeInfo[0].charAt(0),s=e.finalTimeInfo[0].charAt(1),i=e.finalTimeInfo[0].split("-")[1],a=e.finalTimeInfo[0].split("-")[2];if(e.unassignCases[c].status="assigning",e.unassignCases[c].consultation_day=n,e.unassignCases[c].consultation_time=s,e.unassignCases[c].counselor_name=a,e.unassignCases[c].counselor_id=e.counselors.filter((function(e){return e.name==a}))[0].id,e.unassignCases[c].first_consultation_date=e.getDateStr(i),e.unassignCases[c].consultation_number=0,t[i].rows[a].block[s]=fe.a.cloneDeep(e.unassignCases[c]),i<2){var r=parseInt(i)+7;t[r].rows[a].block[s]=fe.a.cloneDeep(e.unassignCases[c]),t[r].rows[a].block[s].consultation_number=1,t[r].rows[a].block[s].isLater=!0}e.finalTimeInfo.shift()}(),c+=1}return setTimeout((function(){e.loading=!1}),"1000"),t},makeTree:function(e,t){var n=this;if(this.unassignCases[t+1])if(e.fit_time.length>0){var s=0;if(e.fit_time.forEach((function(i){var a=n.fitEmptyTimeList(n.unassignCases[t+1].available_time,n.removeEmptyTimeList(e.remain_time,0,0,0,0,i));if(a.length>s){s=a.length;var r={timeInfo:e.timeInfo+i+",",remain_time:n.removeEmptyTimeList(e.remain_time,0,0,0,0,i),fit_time:a};n.makeTree(r,t+1)}})),0==s){var i=e.fit_time[0],a={timeInfo:e.timeInfo+i+",",remain_time:this.removeEmptyTimeList(e.remain_time,0,0,0,0,i),fit_time:this.fitEmptyTimeList(this.unassignCases[t+1].available_time,this.removeEmptyTimeList(e.remain_time,0,0,0,0,i))};this.makeTree(a,t+1)}}else{var r={timeInfo:e.timeInfo+"unassign,",remain_time:e.remain_time,fit_time:this.fitEmptyTimeList(this.unassignCases[t+1].available_time,e.remain_time)};this.makeTree(r,t+1)}else{var o=e.timeInfo+e.fit_time[0];this.finalTimeInfo=o.split(",")}},fitEmptyTimeList:function(e,t){return t.filter((function(t){return e.indexOf(t.split("-")[0])>=0}))},clearRepeatTime:function(e){return e.forEach((function(t){var n=t.split("-");n[1]=parseInt(n[1])+7;var s=e.indexOf(n.join("-"));s>=0&&e.splice(s,1)})),e},removeEmptyTimeList:function(e,t,n,s,i){var a,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=[],c=-1;while(++c<e.length)o[c]=e[c];return a=r?o.indexOf(r):o.indexOf("".concat(t).concat(n,"-").concat(s,"-").concat(i)),a>-1&&o.splice(a,1),Object.values(o)},getDateStr:function(e){var t=new Date;return t.setDate(t.getDate()+parseInt(e)),t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()},getDatetime:function(e){var t=["（日）","（ㄧ）","（二）","（三）","（四）","（五）","（六）"],n=new Date;n.setDate(n.getDate()+parseInt(e));var s=n.getFullYear()+" / "+(n.getMonth()+1)+" / "+n.getDate()+"  "+t[n.getDay()];return s},allowDrop:function(e){e.preventDefault()},drag:function(e){e.dataTransfer.setData("text",e.target.id)},drop:function(e){e.preventDefault();var t=e.dataTransfer.getData("text");e.target.classList.contains("unassign-block")?e.target.appendChild(document.getElementById(t)):this.removeTimeblock({id:t.split("-")[1],dis:"table"})},setDragPos:function(e){this.dragPos=e},removeTimeblock:function(e){var t=this,n=e.id,s=e.dis;if("table"==s)Object.keys(this.timetable).forEach((function(e){Object.keys(t.timetable[e].rows).forEach((function(s){Object.keys(t.timetable[e].rows[s].block).forEach((function(i){t.timetable[e].rows[s].block[i].id==n&&(t.changeCaseStatus(n,"unassign"),t.timetable[e].rows[s].block[i]="unassign")}))}))}));else if(""!=this.dragPos){var i=this.dragPos.split("-");this.timetable[parseInt(i[0])+7]&&(this.timetable[parseInt(i[0])+7].rows[i[1]].block[i[2]]="unassign"),this.timetable[i[0]].rows[i[1]].block[i[2]]="unassign"}},addTimeblock:function(e,t,n,s){for(var i=this.dayList.find((function(e){return e.offset==t})),a=0;a<this.unassignCases.length;a++)if(this.unassignCases[a].id==e)return this.timetable[t].rows[n].block[s]=this.unassignCases[a],this.unassignCases[a].status="assigning",this.unassignCases[a].counselor_name=n,this.unassignCases[a].counselor_id=this.counselors.filter((function(e){return e.name==n}))[0].id,this.unassignCases[a].consultation_day=i.name,this.unassignCases[a].consultation_time=s,this.unassignCases[a].first_consultation_date=this.getDateStr(t),void(this.timetable[t+7]&&("unassign"!=this.timetable[t+7].rows[n].block[s]&&this.changeCaseStatus(this.timetable[t+7].rows[n].block[s].id,"unassign"),this.timetable[t+7].rows[n].block[s]=fe.a.cloneDeep(this.unassignCases[a]),this.timetable[t+7].rows[n].block[s].consultation_number=1,this.timetable[t+7].rows[n].block[s].isLater=!0))},changeCaseStatus:function(e,t){var n=this.unassignCases.find((function(t){return t.id==e}));n&&(n.status=t,console.log(this.unassignCases))},putCase:function(e,t){var n={};n="closed"==t.status?{status:t.status,end_consultation_date:t.end_consultation_date}:"unassign"==t.status?{status:t.status}:{status:t.status,consultation_day:t.consultation_day,consultation_time:t.consultation_time,counselor_id:t.counselor_id,counselor_name:t.counselor_name,first_consultation_date:t.first_consultation_date},this.$http.put("/api/cases/"+e,n).then((function(e){console.log(e.data.message)})).catch((function(e){console.log(e)}))},submitChange:function(){for(var e=fe.a.cloneDeep(this.assigningCases),t=0;t<this.assigningCases.length;t++)e[t].status="assign",this.putCase(e[t].id,e[t]);this.dialogVisible=!0},downloadXLS:function(){var e=fe.a.cloneDeep(this.assigningCases);return this.convertCases(e)},downloadCSV:function(){var e=fe.a.cloneDeep(this.assigningCases),t=this.convertCases(e),n=this.buildCSVContent(t),s=encodeURI(n);window.open(s)},formatConsultationDateTime:function(e){var t=this.days.find((function(t){return t.value==e.consultation_day})).label,n=this.times.find((function(t){return t.value==e.consultation_time})).label;return"星期"+t+" "+n},convertCases:function(e){var t=this;return e.map((function(e){return Object(V["a"])(Object(V["a"])({},e),{},{consultation_datetime:t.formatConsultationDateTime(e),init_consultation_date:t.convertUTCtoStr(e.init_consultation_date)})}))},buildRow:function(e){var t=this;return Object.keys(this.json_fields).map((function(n){return e[t.json_fields[n]]}))},buildCSVContent:function(e){var t=this,n=[Object.keys(this.json_fields)];return e.forEach((function(e){n.push(t.buildRow(e))})),"data:text/csv;charset=utf-8,"+n.map((function(e){return e.join(",")})).join("\r\n")},handleClose:function(){for(var e=this,t=fe.a.cloneDeep(this.assigningCases),n=function(n){Object.keys(e.timetable).forEach((function(s){Object.keys(e.timetable[s].rows).forEach((function(i){Object.keys(e.timetable[s].rows[i].block).forEach((function(a){e.timetable[s].rows[i].block[a].id==t[n].id&&(e.timetable[s].rows[i].block[a].status="assign",e.timetable[s].rows[i].block[a].consultation_number=1)}))}))}))},s=0;s<t.length;s++)n(s);this.unassignCases=this.unassignCases.filter((function(e){return"unassign"==e.status}))},endCase:function(e){var t=e;t.status="closed",t.end_consultation_date=this.getDateStr(t.offset),this.putCase(t.id,t),this.removeTimeblock({id:e.id})},returnCase:function(e){var t=e;t.status="unassign",t.consultation_number=0,this.putCase(t.id,t),this.removeTimeblock({id:e.id,dis:"table"}),this.unassignCases.push(e)},getLabelColor:function(e){var t=this.labelOption.find((function(t){return t.label===e}));return t?t.color:"#409EFF"},getStyleForLabel:function(e){var t=this.getLabelColor(e);return"background-color: ".concat(t,"44; color: ").concat(t,"; border: 1px solid ").concat(t)}}};n("6229");const me=re()(de,[["render",B],["__scopeId","data-v-c1db902e"]]);t["default"]=me},d998:function(e,t,n){var s=n("342f");e.exports=/MSIE|Trident/.test(s)},dbb4:function(e,t,n){var s=n("23e7"),i=n("83ab"),a=n("56ef"),r=n("fc6a"),o=n("06cf"),c=n("8418");s({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){var t,n,s=r(e),i=o.f,l=a(s),u={},b=0;while(l.length>b)n=i(s,t=l[b++]),void 0!==n&&c(u,t,n);return u}})},e04c:function(e,t,n){"use strict";n("366f")},e439:function(e,t,n){var s=n("23e7"),i=n("d039"),a=n("fc6a"),r=n("06cf").f,o=n("83ab"),c=i((function(){r(1)})),l=!o||c;s({target:"Object",stat:!0,forced:l,sham:!o},{getOwnPropertyDescriptor:function(e,t){return r(a(e),t)}})},f745:function(e,t,n){}}]);
//# sourceMappingURL=chunk-abe9db4c.1e52ce17.js.map